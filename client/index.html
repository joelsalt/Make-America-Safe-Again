<!DOCTYPE html>
<html lang="en" ng-app>

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>MASA</title>
  <!-- Bootstrap -->
  <link href="css/bootstrap.css" rel="stylesheet">
  <link href="css/animate.css" rel="stylesheet">
  <link href="css/mobileView.css" rel="stylesheet">

  <script src="/socket.io/socket.io.js"></script>

  <style>
    a:hover {
      font-weight: normal;
    }
    
    .well {
      -webkit-box-shadow: 10px 10px 51px 0px rgba(0, 0, 0, 0.75);
      -moz-box-shadow: 10px 10px 51px 0px rgba(0, 0, 0, 0.75);
      box-shadow: 10px 10px 51px 0px rgba(0, 0, 0, 0.75);
    }
    
    .shadow {
      color: #FCFCFC;
      background-color: black;
      border: 1px solid black;
      opacity: .9;
      filter: alpha(opacity=90);
      /* For IE8 and earlier */
      padding-bottom: 8px;
      padding-top: 4px;
      padding-left: 4px;
    }
    
    .text-input {
      min-height: 75px;
    }
    
    .btn-warning{
      background-color: rgba(50, 255, 255, 0.65);
    }
    .btn-warning:hover{
      background-color: rgba(25, 200, 200, 0.65);
    }
    
    .well:hover{
      background-color: #fff;
    }
  </style>



  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
		  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
</head>

<body>

  <div hidden id="theusername"></div>
  <div hidden id="thefeed"></div>
  
  <div hidden id="saveuser"></div>
  <div hidden id="savevideo"></div>
  
  <nav class="navbar navbar-default" style="margin-bottom: 0px;">
    <div class="container-fluid" style="margin-bottom: 0px;">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false" style="width: 42px;"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button>
        <div class="navbar-brand">Make America Safe Again</div>
      </div>

      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1" ng-controller="ChatController">
        <ul class="nav navbar-nav">


        </ul>

        <ul class="nav navbar-nav navbar-right">
          <li id="adminId" class="hidden"><a data-toggle="tab" href="#admin"><strong>Admin</strong></a></li>
          <li id="monitorId" class="hidden"><a data-toggle="tab" href="#monitor"><strong>Monitor</strong></a></li>
          <li id="profileId" class="hidden"><a data-toggle="tab" href="#profile">Profile</a> </li>
          <li id="loginId" class="active"><a data-toggle="tab" href="#login">Log In</a> </li>
          <li id="signupId"><a data-toggle="tab" href="#signup">Sign Up</a></li>
          <li id="logoutId" class="hidden"><a data-toggle="tab" ng-click="logout();" href="#login">Log Out</a></li>

        </ul>
      </div>
      <!-- /.navbar-collapse -->
    </div>
    <!-- /.container-fluid -->
  </nav>
  <div class="tab-content" id="main">
    <div id="signup" class="tab-pane fade in" ng-controller="ChatController">
      <div class="container-fluid" style="overflow: hidden; background-image: url(img/bg5.png); background-size: cover; background-position: center center; min-height: 100vh;">
        <div class="row">
          <div class="col-xs-12 col-sm-4 col-xs-offset-0 col-sm-offset-1">
            <div class="well animated zoomIn first" style="margin-top: 16px; opacity: .9; filter: alpha(opacity=90);">
              <h3 class="shadow"><strong>Make America Safe Again</strong></h3>



            </div>
          </div>
          <div class="col-xs-12 col-sm-6">
            <div class="well container-fluid animated zoomIn first" style="margin-top: 16px; opacity: .9; filter: alpha(opacity=90);">
              <h2 class="shadow">Sign Up</h2>
              <form>
                <div class="form-group">
                  <label for="exampleInputUser1">User Name</label>
                  <input type="text" class="form-control" ng-model="username" id="exampleInputUser1" aria-describedby="userHelp"  placeholder="Enter username" required />
                  <small id="userHelp" class="form-text text-muted">We'll never share your info with anyone else.</small>
                </div>
                <div class="form-group">
                  <label for="pass1">Password</label>
                  <input type="text" class="form-control" ng-model="validate1" id="pass1" placeholder="Enter password" required>
                  <label for="pass2">Re-Enter Password</label>
                  <input type="text" id="registerTxt" class="form-control" ng-change="checkPasswords()" ng-model="validate2" id="pass2" placeholder="Re-Enter password" required>
                  <div id="passwordAlert" class="alert alert-danger hidden">
                    <p class="text-danger text-strong">Passwords do not match</p>
                  </div>
                </div>
                <button type="button" id="registerBtn" data-toggle="tab" data-target="#monitor" ng-click="register();" class="btn btn-primary shadow">Submit</button>

              </form>

            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="profile" class="tab-pane fade in">
      <div class="container-fluid" style="overflow: hidden; background-image: url(img/bg5.png); background-size: cover; background-position: center center; min-height: 100vh;">
        <div class="row">
          <div class="col-xs-12 col-sm-4 col-xs-offset-0 col-sm-offset-1">
            <div class="well animated zoomIn first" style="margin-top: 16px; opacity: .9; filter: alpha(opacity=90);">
              <h3 hidden class="shadow"><strong>Succesful Tips</strong></h3>
              <ul hidden class=shadow>
                <li>Example 1</li>
                <li>Example 2</li>
                <li>Example 3</li>
              </ul>
              <h3 class="shadow"><strong>About</strong></h3>
              <p class="shadow">AI is not at the point where it can prevent shop lifting versus normal in store behavior. We created a solution that crowdsources public safety and loss prevention. Let’s make America safe again.

              </p>
              <p class="shadow">Building a wall across the US Mexico border is expected to cost upwards of 20 Billion dollars. The biggest problems that border patrol have reported is that there is too much area to cover and not enough manpower. We have created an option
                that can give the power back to the public. It is a cost effective solution to place web cameras to cover the border. The public now can take matters into their own hands and report when the border is crossed to nearby officers who can
                then respond. We shouldn’t be forced to pay 20 billion in taxes to a solution that still doesn’t account for truly monitoring the border. We are a better option for a better tomorrow. Let’s make America safe again.</p>

            </div>
          </div>
          <div class="col-xs-12 col-sm-6">
            <div class="well container-fluid animated zoomIn first" style="margin-top: 16px; opacity: .9; filter: alpha(opacity=90);">
              <div class="row">
                <div class="col-xs-6 col-sm-4">
                  <img id="avatar" class="img-circle img-responsive" src="./img/trump.png" style="width: 100%; border: #D1CECE 8px solid;">
                </div>
                <div class="col-xs-6 col-sm-6 text-center">
                  <h2><strong>Rating: </strong> <div id="rating">100%</div></h2>
                </div>
              </div>
              
              <h4 class="shadow" style="padding:8px;">Welcome <div id="whoami">who</div></h4>
              <h4 class="shadow" style="padding:8px;">Points: <div id="upval">111</div><div id="downval">222</div> </h4>

            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="login" class="tab-pane fade in active" ng-controller="ChatController">
      <div class="container-fluid" style="overflow: hidden; background-image: url(img/bg5.png); background-size: cover; background-position: center center; min-height: 100vh;">
        <div class="row">
          <div class="col-xs-12 col-sm-4 col-xs-offset-0 col-sm-offset-1">
            <div class="well animated zoomIn first" style="margin-top: 16px; opacity: .9; filter: alpha(opacity=90);">
              <h3 class="shadow"><strong>Make America Safe Again</strong></h3>
              <img src="./img/masa.png" width="100%" class="animated zoomIn de" />

            </div>
          </div>
          <div class="col-xs-12 col-sm-6">
            <div class="well container-fluid animated zoomIn first" style="margin-top: 16px; opacity: .9; filter: alpha(opacity=90);">
              <h2 class="shadow">Login</h2>
              <form>
                <div class="form-group">
                  <label for="exampleInputUser1">User Name</label>
                  <input type="text" class="form-control" ng-model="username" id="exampleInputUser1" aria-describedby="userHelp" placeholder="Enter username" required>
                  <small id="userHelp" class="form-text text-muted">We'll never share your info with anyone else.</small>
                </div>
                <div class="form-group">
                  <label for="pass">Password</label>
                  <input type="text" class="form-control" ng-change="validate();" ng-model="password" id="pass" placeholder="Enter password" required>

                </div>
                <button type="button" id="loginBtn" data-toggle="tab" data-target="#monitor" class="btn btn-primary shadow">Submit</button>

              </form>


            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="about" class="tab-pane fade in">

    </div>
    <div id="admin" class="tab-pane fade in">
      <div class="container-fluid" style="overflow: hidden; background-image: url(img/bg5.png); background-size: cover; background-position: center center; min-height: 100vh;">
        <div class="row text-center">
          <div class="col-xs-8 col-xs-offset-2 col-sm-4 col-sm-offset-4" style="opacity: .9; filter: alpha(opacity=90);">
            <h2 class="shadow">Alerts </h2>
            <hr>
          </div>
          <div class="col-xs-4 col-xs-offset-4" style="margin-bottom: 8px;">
            <div id="adminButtons"></div>
          </div>
        </div>

        <div class="row">


          <div class="col-xs-12 col-sm-8 col-sm-offset-2 shadow" style="opacity: .9; filter: alpha(opacity=90); margin-bottom:8px;">
            <div class="row" style="opacity: .9; filter: alpha(opacity=90); padding-top: 8px; padding-bottom: 8px;">
              <div class="col-xs-10 col-sm-3 col-xs-offset-1 text-center">
               <iframe id="adminvideofeed" style="width:100%;height:25vw;width:40vw;" src="" frameborder="0" allowfullscreen></iframe>
              </div>
              <div class="col-xs-6 col-xs-offset-2 col-sm-offset-0 col-sm-5">
              
              </div>
              <div id="up" class="col-xs-1" style="padding:3px; margin-top:8px;"><img src="img/up.png" width="100%" class="img-circle"></div>
              <div id="down" class="col-xs-1" style="padding:3px; margin-top:8px;"><img src="img/down.png" width="100%" class="img-circle"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="monitor" class="tab-pane fade in">
      <div class="container-fluid" style="overflow: hidden; background-image: url(img/bg5.png); background-size: cover; background-position: center center; min-height: 100vh;">
        <div class="row">

          <div class="container-fluid" style="margin-top: 16px; opacity: .9; filter: alpha(opacity=90);">
            <div id="anim1" class="col-sm-6 col-sm-offset-3 zoomIn first">
              <!--animated-->

            </div>
          </div>

        </div>

        <div class="container-fluid" ng-controller="ChatController" style="margin-top: 2px; opacity: .9; filter: alpha(opacity=90);">
          <div hidden class="page-header">
            <h3 id="anim2" class="shadow zoomIn dd">Monitor System</h3>
            <!--animated-->
          </div>
          <div class="row">
            <div class="well zoomIn col-sm-3 col-xs-12" id="alertadmin" style="cursor: pointer; margin-top: 8px;">
                <!--animated-->
                <div class="row">
                  <div class="col-xs-12 col-sm-12">
                    <div class="col-xs-6 col-xs-offset-3 col-sm-8 col-sm-offset-2">
                      <img style="padding-left: 20px;" class="media-left" src="img/hazard.png" width="100%">
                    </div>
                    </div>
                    </div>
                    <div class="row">
                  <div class="col-xs-12 col-sm-12" >
                    <h3 class="text-center" id="alertText">Something Not Right? Send an Alert!</h3>
                    <h4 class="text-center" id="alertText2">Click me</h4>
                  </div>
                </div>
              </div>
            
            <div class="col-sm-6 col-xs-12 col-xs-offset-0">
              <iframe id="videofeed" style="width:100%;height:25vw;" src="https://www.youtube.com/embed/gGVdY2D-GSI?rel=0&amp;autoplay=1" frameborder="0" allowfullscreen></iframe>
            </div>
            <div class="col-sm-3 col-xs-12">
              <div id="camchoices" class="text-center"> </div>
              <br />

            </div>
          </div>
          <hr/>

          <div class="row">
            <div id="anim3" class="col-xs-12 col-sm-12 zoomIn de">
              <!--animated-->
              <ul hidden class="nav nav-list well">
                <li class="nav-header">Local Users</li>
                <h1 class="shadow pull-right" style="padding-right: 8px;">Chat</h1>
                <li ng-repeat="user in roster" ng-bind="user">
                </li>
              </ul>

              
            </div>
            <div id="anim5" class="col-xs-12 col-sm-12 zoomIn first" style="margin-top: 8px;">
              <!--animated-->
              <div style="height:100px;overflow-y:auto;border-radius: 4px;" id="scroll">
                <table class="table table-condensed table-hover table-bordered" style="background-color:rgba(200, 200, 200, 0.75); ">
                  <tbody>
                    <tr height="20" ng-repeat="msg in messages" style="height:20px;">
                      <td class="">
                        <p style="color:black;"><strong>{{ msg.name }} </strong> {{ msg.text }}</p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div id="anim6" class="row controls zoomIn de">
                <!--animated-->
                <form>
                  <div class="input-append">
                    <input type="text" id="them" style="border-radius: 4px;"class="text-input" ng-model="text" placeholder="Message">
                    <input type="button" ng-click="send();" class="btn btn-primary shadow" id="sendchat" value="Send" ng-disabled="!text"><i class="hidden "></i>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="js/jquery-1.11.3.min.js"></script>


  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="js/bootstrap.js"></script>

  <!-- Angular -->
  <script src="/js/angular.min.js"></script>

  <script>
  
    var alreadyalerted = false;

    var socket = io.connect();

    var videoChoices = [];

    $("#up").click(function() {
      console.log("The alert up  was clicked. " + $('#saveuser').val() + " " + $('#savevideo').val());
      socket.emit("vote_up", {'user': $('#saveuser').val(), 'video': $('#savevideo').val() })
    });
    
    $("#down").click(function() {
      console.log("The alert down  was clicked. " + $('#saveuser').val() + " " + $('#savevideo').val());
      socket.emit("vote_down", {'user': $('#saveuser').val(), 'video': $('#savevideo').val() })      
    });    


    $("#alertadmin").click(function() {
      
     $('#alertText').text("An alert was sent to the Admin");
     $('#alertText2').text("");
      console.log("The alert admin was clicked. " + $('#theusername').val() + " " + $('#thefeed').val());
      socket.emit("Alert", {
        username: $('#theusername').val(),
        videosource: $('#thefeed').val(),
        
      });
    });

    /* global io */
    /* global $ */
    function ChatController($scope) {

      $('#them').keydown(function(e) {
        if (e.keyCode == 13) {
          console.log("ENTER");
          $scope.send();
          e.preventDefault();
        }

      });

      $scope.messages = [];
      $scope.roster = [];
      $scope.name = '';
      $scope.text = '';
      $scope.username = '';
      $scope.password = '';
      // Used for validating passwords
      $scope.validate1 = '';
      $scope.validate2 = '';

      socket.on('connect', function() {
        socket.emit('identify', $scope.username);
      });

      //socket.on("")

      socket.on('message', function(msg) {
        $scope.messages.unshift(msg);
        $scope.$apply();
      });

      socket.on('roster', function(names) {
        $scope.roster = names;
        $scope.$apply();
      });

      socket.on('Alert_Admin', function(data) {
        
        $('#saveuser').val(data.username);
        $('#savevideo').val(data.videosource);

        //if (!alreadyalerted) {

          console.log("ouch " + $('#theusername').val());
          
          if ($('#theusername').val() == 'admin') {
            // var userAdmin = data.username;
            // var videosourceAdmin = data.videosource;  
            
            /*global SpeechSynthesisUtterance*/
            /*global speechSynthesis*/
                var u = new SpeechSynthesisUtterance();
                u.text = $('#saveuser').val(); + " identified a threat";
                //u.lang = language.value;
                u.rate = 1.0;
                u.onend = function (event) {};
                speechSynthesis.speak(u);

            console.log("alert admin data" + JSON.stringify(data));

            var $div = $("<div class='btn btn-info'>", {
              id: data.videosource
            }).html("<span class=''>" + data.username + data.videosource + "</span>");
            
            $div.click(function() {
              console.log('clicked the page: @@' + data.username + data.videosource);
              //socket.emit reputation
              //setdiv(videoChoices.videosource + "?autoplay=1");
            });
            
            console.log("vs: " + data.videosource);
           // console.log("alert admin div id" + $('#'+data.videosource).val());
      
            
            $('#adminvideofeed').attr("src",data.videosource);
              $("#adminButtons").html($div);
              $("#cameraName").html();
            //  $("#adminButtons").append('<br />');
           
            //alreadyalerted = true;
            
          //}

        }

      });

      socket.on('Validated', function(data) {
        $("#loginBtn").attr("disabled", false);
        $("#loginId").addClass("hidden");
        $("#signupId").addClass("hidden");
        $("#profileId").removeClass("hidden");
        $("#logoutId").removeClass("hidden");

        if (data.user.username === "admin") {
          $('#theusername').val(data.user.username);
          $("#adminId").removeClass("hidden");
        }
        else {
          $("#monitorId").removeClass("hidden");
          $('#theusername').val(data.user.username);
        }

        console.log("response!" + JSON.stringify(data.user) + " " + JSON.stringify(data.cams));
        console.log("User name " + data.user.username);

        videoChoices = data.cams;

        $('#camchoices').empty();
        console.log("xxxxx: " + JSON.stringify(videoChoices));
        for (var i = 0; i < videoChoices.length; i++) {
          console.log("video choices" + JSON.stringify(videoChoices[i]));
          createVideoChoice(videoChoices[i]);
        }

        function createVideoChoice(videoChoices) {
          var $div = $("<div class='btn btn-info'>", {
            id: videoChoices.videosource
          }).html("<span class='inner'>" + videoChoices.name + "</span>");
          $div.click(function() {
            console.log('clicked the page: @@' + videoChoices.videosource);
            setdiv(videoChoices.videosource + "?rel=0&amp;autoplay=1");
          });
          $("#camchoices").append($div);
          $("#camchoices").append('<br />');
        }
        
        $("#profileId").click(function(){
          console.log("emitted profile");
          socket.emit('Profile', $scope.username);
        });

        $scope.username = data.user.username;

        socket.emit('identify', data.user.username);
      });

      socket.on('Invalid', function(data) {});
      
      socket.on('Profile_Updated', function(data){
        
        var good,bad,total;
        good=data.positive | 0;
        bad=data.negative | 0;
        total = good + bad;  
        console.log("profile updated" + JSON.stringify(data));
        $('#theusername').val(data.username);
        $('#whoami').html(data.username);
        $('#upval').html("Positive Reputation: "+good);
        $('#downval').html("Negative Reputation: "+bad);
        
        if (total!=0) $('#rating').html(((data.positive / (data.positive + data.negative)) * 100).toFixed(2) + "%");
        if (total==0) $('#rating').html("No Score Yet");
        
        if ( (good / (good+bad))  * 100 < 50) {
          $('#avatar').attr("src","./img/badtrump.png");

          
        } else {
          $('#avatar').attr("src","./img/trump.png");

          
        }
      });

      function setdiv(str) {
        $('#videofeed').attr("src", str); //videoChoices.videosource;
        $('#thefeed').val(str);
      }

      $scope.setName = function() {

      };

      $scope.send = function send() {
        console.log('Sending message:', $scope.text);
        socket.emit('message', $scope.text);
        $scope.text = '';
      };

      /* $scope.scroll = function() {
               var div = document.getElementById("scroll");
               div.scrollTop = div.scrollHeight + 20;
           };*/

      $scope.checkPasswords = function() {
        if ($scope.validate1 !== $scope.validate2) {
          $("#registerBtn").attr("disabled", true);
          $("#passwordAlert").removeClass("hidden");
        }
        else {
          $("#registerBtn").attr("disabled", false);
          $("#passwordAlert").addClass("hidden");
        }
      };

      $scope.validate = function() {
        var user = {
          username: $scope.username,
          password: $scope.password
        };
        console.log("BEFORE server response user data:", user);
        socket.emit("User_Login", user);
         if (user.username!=='admin') $('#videofeed').attr("src","https://www.youtube.com/embed/E62EW2j3_T0?rel=0&amp;autoplay=1");
         $("#loginBtn").attr("disabled", true);

        if ($scope.username == "admin") {
          $('#theusername').val('admin');
          $("#loginBtn").attr("data-target", "#admin");
        }
      };

      $scope.register = function() {
        var user = {
          username: $scope.username,
          password: $scope.validate2
        };
        console.log("AFTER server response user data:", user);
        socket.emit("User_Register", user);

        $("#loginId").addClass("hidden");
        $("#signupId").addClass("hidden");
        $("#profileId").removeClass("hidden");
        $("#monitorId").removeClass("hidden");
        $("#logoutId").removeClass("hidden");
      };
      
      $scope.logout = function(){
        $("#loginId").removeClass("hidden");
        $("#signupId").removeClass("hidden");
        $("#profileId").addClass("hidden");
        $("#monitorId").addClass("hidden");
        $("#logoutId").addClass("hidden");
      };

    }
  </script>
</body>

</html>
